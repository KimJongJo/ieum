<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.reservation">

	<!-- 시간 조회 -->
	<select id="selectResTime" parameterType="map" resultType="reservation">
		select *
		from reservation
		where m_no=#{mNo} and r_date=#{rDate}
	</select>

	<!-- 예약하기 -->
	<insert id="insertReservation" parameterType="reservation">
		insert into
		reservation
		(r_date,r_time,r_content,act_name,act_tel,r_status,r_day,h_no,u_no,m_no)
		values
		(#{rDate},#{rTime},#{rContent},#{actName},#{actTel},#{rStatus},#{rDay},#{hNo},#{uNo},#{mNo})
	</insert>


	<!-- 오늘 예약인 예약 리스트 -->





























	<!-- 유저의 가장 최근 예약건 -->
	<select id="latestRes" parameterType="Integer" resultType="Integer">
		select MAX(r_no)
		from reservation
		where u_no =#{uNo}
	</select>
	
	<!-- 예약 상세 -->
	<select id="ResDetail" parameterType="Integer" resultType="resInfo">
		select *
		from reservation r
		join hospital h
		using(h_no)
		join member m
		on (r.m_no = m.u_no)
		where r_no=#{rNo}
	</select>
	
	<!-- 예약된 의사번호 -->
	<select id="resDocMno" parameterType="Integer" resultType="Integer">
		select m_no
		from reservation
		where r_no=#{rNo}
	</select>
	
	<!-- 다가오는예약 리스트 -->
	<select id="commingRes" parameterType="Integer" resultType="resInfo">
		select *
		from reservation r
		join hospital h
		using(h_no)
		join member m
		on (r.m_no = m.u_no)
		left join file f
		on (m.file_no = f.file_no)
		where r.u_no=#{uNo} and r.r_status='WAITING'
		order by r.r_no ASC
	</select>
	
	<!-- 지난예약 리스트 -->
	<select id="recordRes" parameterType="Integer" resultType="resInfo">
		select *
		from reservation r
		join hospital h
		using(h_no)
		join member m
		on (r.m_no = m.u_no)
		left join file f
		on (m.file_no = f.file_no)
		where r.u_no=#{uNo} and r.r_status='COMPLETE'
		order by r.r_no DESC
	</select>


</mapper>	