<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.community">
	<!-- 커뮤니티 작성 -->
	<insert id="insertCommunity" parameterType="dto.CommunityDto" useGeneratedKeys="true" keyProperty="commuNo">
	    insert into community (u_no, commu_title, commu_content, commu_views, empathy, commu_created, commu_declaration, category_no, commu_comment)
	    values (#{uNo}, #{commuTitle}, #{commuContent}, 0, 0, now(), 0, #{categoryNo}, 0)
	</insert>
	
	<!-- 특정 커뮤니티 찾기 -->
	<select id="selectByNo" parameterType="int" resultType="community">
	    SELECT
	        commu_no     AS commuNo,
	        u_no         AS uNo,
	        commu_title  AS commuTitle,
	        commu_content AS commuContent,
	        commu_views  AS commuViews,
	        empathy,
	        commu_created AS commuCreated,
	        commu_declaration AS commuDeclaration,
	        category_no  AS categoryNo,
	        commu_comment AS commuComment
	    FROM community
	    WHERE commu_no = #{commuNo}
	</select>

	<!-- 자신이 작성한 커뮤니티 불러오기 -->
	<select id="selectMyCommunityList" parameterType="int" resultType="myCommunity">
        SELECT
            c.commu_no, c.commu_title, c.commu_content, c.commu_created, c.empathy, c.commu_comment, c.commu_views, cg.category_name, m.nickname
        FROM community c
        INNER JOIN commu_category cg ON c.category_no = cg.category_no
        INNER JOIN member m ON c.u_no = m.u_no
        WHERE c.u_no = #{uNo}
        ORDER BY c.commu_created DESC
    </select>
    
    <!-- 모든 커뮤니티 불러오기 -->
    <select id="selectAllCommunityList" resultType="allCommunity">
    	SELECT
            c.commu_no, c.commu_title, c.commu_content, c.commu_created, c.empathy, c.commu_comment, c.commu_views, cg.category_name, m.nickname
        FROM community c
        INNER JOIN commu_category cg ON c.category_no = cg.category_no
        INNER JOIN member m ON c.u_no = m.u_no
        ORDER BY c.commu_created DESC  		
    
    </select>
	       
	<!-- 게시글 삭제 -->
	<delete id="deleteCommunity" parameterType="int">
        delete from community WHERE commu_no = #{commuNo}
    </delete>
  
    <update id="updateCommunity" parameterType="myCommunity">
    	update community set
    		commu_title = #{commuTitle}, commu_content = #{commuContent},category_no = #{categoryNo}
    	where commu_no = #{commuNo} 
    </update>
    
    
    

</mapper>	