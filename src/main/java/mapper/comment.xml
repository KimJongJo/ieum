<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.comment">
	<!-- 1. 댓글 목록 조회 (작성자 닉네임 포함) -->
    <select id="selectCommentWithNick" parameterType="int" resultType="comment">
       	select 
            c.comme_no AS commeNo,
            c.commu_no AS commuNo,
            c.u_no AS uNo,
            c.com_content AS comContent,
            c.com_empathy AS comEmpathy,
            c.com_created AS comCreated,
            c.com_declaration AS comDeclaration,
            m.nickname AS nickName
        from comment c
        join member m ON c.u_no = m.u_no
        where c.commu_no = #{commuNo}
        order by c.com_created ASC
    </select>
	 <!-- 댓글 등록 -->
	<insert id="insertComment" parameterType="comment">
		insert into comment (comme_no, u_no, commu_no, com_content, com_empathy, com_created, com_declaration)
		values (#{commeNo}, #{uNo}, #{commuNo}, #{comContent}, 0, now(), 0)
	</insert>
	
	<!-- 해당 게시글 댓글 삭제 -->
    <delete id="deleteCommentsByCommuNo" parameterType="int">
        delete from comment where commu_no = #{commuNo}
    </delete>
	<!-- 댓글 조회 (특정 커뮤니티) -->
    <select id="selectCommentsByCommuNo" parameterType="int" resultType="comment">
        select * from comment where commu_no = #{commuNo} order by com_created ASC
    </select>

    
	
	
	<!-- 5. 특정 게시글 댓글 수 조회 -->
    <select id="countCommentsByCommuNo" parameterType="int" resultType="int">
        select count(*) from comment where commu_no = #{commuNo}
    </select>

    <!-- 6. community 테이블의 commu_comment 갱신 -->
    <update id="updateCommentCount" parameterType="map">
        update community
        set commu_comment = #{count}
        where commu_no = #{commuNo}
    </update>
    
    <!-- member와 join해서 닉네임과 comment모든 정보 가져오기 -->
    <select id="selectMemberWithComment" parameterType="int" resultType="ComWithMember" >
    	select m.nickname, c.comme_no, c.u_no, c.commu_no, c.com_content, c.com_empathy, c.com_created
		from comment c
		inner join member m
    	on c.u_no = m.u_no
    	order by c.com_created DESC
    </select>
    
    <!-- 댓글 조회 -->
    <select id="selectByNo" parameterType="int" resultType="comment">
    	select * from comment where comme_no = #{commeNo}
    </select>
</mapper>