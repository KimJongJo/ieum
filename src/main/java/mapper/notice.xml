<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.notice">
	<insert id="insertNotice" parameterType="notice">
		INSERT INTO notice
		(title, content, is_pinned, file_no, u_no) VALUES #{title},
		#{content}, #{isPinned}, #{fileNo}, #{uNo}
	</insert>
	<select id="selectNoticeList">
		SELECT n(*), f.file_path, f.file_no FROM notice n
		JOIN file f
		USING(file_no)
		WHERE n.is_pinned = #{isPinned} 
		<if test="keyword != null and keyword != ''">
		AND (title LIKE CONCAT('%', #{keyword}, '%')
        OR content LIKE CONCAT('%', #{keyword}, '%'))
        </if>
		ORDER BY ${sort} DESC
		<if test="topYn == true">
			LIMIT 5
		</if>
		<if test="row != null and row != ''">
			LIMIT #{row}, 10
		</if>
	</select>
	<select id="selectNoticeDetail">
		SELECT n(*), f.file_path, f.file_no FROM notice n
		JOIN file f USING(file_no) WHERE
		n_no = #{nNo}
	</select>
	<select id="selectCnt">
		SELECT COUNT(*) FROM notice WHERE n.is_pinned = false;
	</select>
	<update id="updateNotice">
		UPDATE diary SET
		title=#{title}, content=#{content}, is_pinned=#{isPinned}, n_updated=now(), file_no=#{fileNo}
		WHERE  n_no=#{nNo}
	</update>
	<delete id="delNotice">
		DELETE FROM diary WHERE n_no=#{nNo}
	</delete>
	<select id="selectUserNm" parameterType="Integer"
		resultType="String">
		SELECT username FROM member WHERE u_no = #{uNo}
	</select>
</mapper>	